<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Frogger - Deluxe Edition</title>
    <style>
        body { 
            background: #222; color: white; font-family: sans-serif; text-align: center; 
            margin: 0; padding: 0; overflow: hidden; position: fixed; width: 100%; height: 100%;
        }
        canvas { 
            background: #87CEEB; border: 2px solid #555; display: block; margin: 0 auto; 
            width: 95vw; max-width: 400px; height: auto; touch-action: none;
        }
        #start-screen, #clear-screen { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.85); z-index: 100; 
            display: flex; flex-direction: column; justify-content: center; align-items: center; 
        }
        button { 
            padding: 15px 35px; font-size: 1.5rem; cursor: pointer; 
            background: #2ecc71; border: none; color: white; border-radius: 10px;
            box-shadow: 0 4px #27ae60;
        }
        button:active { transform: translateY(2px); box-shadow: 0 2px #27ae60; }
        h1 { font-size: 2.5rem; margin-bottom: 20px; color: #f1c40f; }
    </style>
</head>
<body>

    <div id="start-screen">
        <h1>FROGGER</h1>
        <button onclick="startGame()">START</button>
    </div>

    <div id="clear-screen" style="display:none;">
        <h1 style="color: #f1c40f;">CONGRATS!</h1>
        <p style="font-size: 1.5rem;">Keyword: Signal</p>
        <button onclick="location.reload()">REPLAY</button>
    </div>

    <canvas id="game" width="400" height="600"></canvas>

    <script>
        const canvas = document.getElementById("game");
        const ctx = canvas.getContext("2d");
        const clearScreen = document.getElementById("clear-screen");

        // --- Èü≥Â£∞Ë®≠ÂÆö ---
        const bgm = new Audio('./assets/sounds/frog.mp3'); bgm.loop = true;
        const seJump = new Audio('./assets/sounds/jump.mp3');
        const seCrash = new Audio('./assets/sounds/crash.mp3');
        const seGoal = new Audio('./assets/sounds/goal.mp3');

        // --- ÁîªÂÉèË®≠ÂÆö ---
        const frogImg = new Image();
        frogImg.src = './assets/images/frog.png';
        const logImg = new Image();
        logImg.src = './assets/images/log.png';

        let gameStarted = false;
        let isCleared = false;
        const gridSize = 50;
        const player = { x: 4, y: 11, char: "üê∏", vx: 0 };
        let particles = [];

        function startGame() {
            document.getElementById("start-screen").style.display = "none";
            gameStarted = true;
            bgm.play().catch(() => {});
            draw();
        }

        // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´ÁîüÊàê„É≠„Ç∏„ÉÉ„ÇØ
        function createParticles(x, y, color, count = 8, speed = 3, type = 'normal') {
            for(let i=0; i<count; i++) {
                particles.push({
                    x: x, y: y,
                    vx: (Math.random()-0.5) * speed,
                    vy: (Math.random()-0.5) * speed - (type === 'celebrate' ? 3 : 0),
                    life: 1.0,
                    color: color,
                    size: type === 'celebrate' ? Math.random() * 6 + 2 : 4
                });
            }
        }

        const obstacles = [
            {x: 1, y: 10, icon: "üå≤"}, {x: 6, y: 10, icon: "üß±"},
            {x: 3, y: 9, icon: "üå≤"}, {x: 5, y: 9, icon: "üß±"}
        ];

        const lanes = [
            { y: 8, speed: 1.5, dir: -1, logs: [{x:0, w:60}, {x:200, w:60}] },
            { y: 7, speed: 1.0, dir: 1,  logs: [{x:50, w:100}, {x:300, w:100}] },
            { y: 6, speed: 2.0, dir: -1, logs: [{x:100, w:50}, {x:300, w:50}] },
            { y: 5, speed: 1.2, dir: 1,  logs: [{x:0, w:120}, {x:250, w:120}] }
        ];

        function draw() {
            if (!gameStarted) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // 1. „É¨„Ç§„É§„Éº1: ËÉåÊôØÔºàÂ∑ù„Å®Á©∫Ôºâ
            ctx.fillStyle = "#87CEEB"; ctx.fillRect(0, 0, 400, 600);
            ctx.fillStyle = "#2980b9"; ctx.fillRect(0, 250, 400, 200);

            // 2. „É¨„Ç§„É§„Éº2: ‰∏∏Â§™ÔºàÁîªÂÉèÔºâ
            let onLog = false;
            lanes.forEach(lane => {
                lane.logs.forEach(log => {
                    log.x += lane.speed * lane.dir;
                    if (log.x > 400) log.x = -log.w; if (log.x < -log.w) log.x = 400;
                    
                    if (logImg.complete && logImg.naturalWidth !== 0) {
                        ctx.drawImage(logImg, log.x, lane.y * gridSize + 5, log.w, 40);
                    } else {
                        ctx.fillStyle = "#5d4037";
                        ctx.fillRect(log.x, lane.y * gridSize + 5, log.w, 40);
                    }

                    if (!isCleared && player.y === lane.y && (player.x * gridSize + 25) > log.x && (player.x * gridSize + 25) < log.x + log.w) {
                        onLog = true; player.vx = lane.speed * lane.dir;
                    }
                });
            });

            // 3. „É¨„Ç§„É§„Éº3: ËäùÁîü
            ctx.fillStyle = "#2ecc71";
            ctx.fillRect(0, 450, 400, 150); // ÊâãÂâç
            ctx.fillRect(0, 200, 400, 50);  // ‰∏≠Ê¥≤
            ctx.fillRect(0, 0, 400, 200);   // „Ç¥„Éº„É´ËäùÁîüÔºàÈöôÈñì„Å™„ÅóÔºâ

            // 4. „É¨„Ç§„É§„Éº4: ÂÆ∂„ÉªÈöúÂÆ≥Áâ©
            ctx.font = "45px Arial";
            ctx.fillText("üè†", 4 * gridSize + 2, 45);
            ctx.font = "35px Arial";
            obstacles.forEach(obs => ctx.fillText(obs.icon, obs.x * gridSize + 5, obs.y * gridSize + 40));

            // 5. „É¨„Ç§„É§„Éº5: „Éë„Éº„ÉÜ„Ç£„ÇØ„É´
            particles.forEach((p, i) => {
                p.x += p.vx; p.y += p.vy; p.life -= 0.02;
                if (isCleared) p.vy += 0.1; // „Ç¥„Éº„É´Âæå„ÅØÈáçÂäõËøΩÂä†
                ctx.fillStyle = p.color; ctx.globalAlpha = p.life;
                ctx.fillRect(p.x, p.y, p.size, p.size);
                if(p.life <= 0) particles.splice(i, 1);
            });
            ctx.globalAlpha = 1.0;

            // 6. „É¨„Ç§„É§„Éº6: „Éó„É¨„Ç§„É§„ÉºÔºàÁîªÂÉèÔºâ
            if (!isCleared) {
                if (onLog) { 
                    player.x += player.vx / gridSize;
                    if(player.x < 0) player.x = 0; if(player.x > 7) player.x = 7;
                }
                if (frogImg.complete && frogImg.naturalWidth !== 0) {
                    ctx.drawImage(frogImg, player.x * gridSize, player.y * gridSize, gridSize, gridSize);
                } else {
                    ctx.fillText(player.char, player.x * gridSize + 5, player.y * gridSize + 40);
                }
            }

            // 7. Âà§ÂÆöÔºàÊ∞¥Ê≤°Ôºâ
            if (!isCleared && player.y >= 5 && player.y <= 8 && !onLog) {
                createParticles(player.x * gridSize + 25, player.y * gridSize + 25, "#FFF", 15, 5);
                seCrash.currentTime = 0; seCrash.play(); resetPlayer();
            }

            // 8. „Ç¥„Éº„É´ÊºîÂá∫
            if (!isCleared && player.y === 0 && Math.round(player.x) === 4) {
                isCleared = true;
                seGoal.play();
                clearScreen.style.display = "flex";
                for(let j=0; j<10; j++) {
                    setTimeout(() => {
                        const colors = ["#f1c40f", "#e74c3c", "#3498db", "#9b59b6", "#ffffff"];
                        createParticles(Math.random()*400, Math.random()*300, colors[j%5], 40, 10, 'celebrate');
                    }, j * 150);
                }
            }
            requestAnimationFrame(draw);
        }

        function resetPlayer() { player.x = 4; player.y = 11; player.vx = 0; }

        function move(dx, dy) {
            if (!gameStarted || isCleared) return;
            let nextX = Math.round(player.x + dx);
            let nextY = player.y + dy;
            if (obstacles.some(obs => obs.x === nextX && obs.y === nextY)) return;
            if (nextX >= 0 && nextX <= 7) player.x = nextX;
            if (nextY >= 0 && nextY <= 11) player.y = nextY;
            createParticles(player.x * gridSize + 25, player.y * gridSize + 40, "#bdc3c7", 6, 2);
            seJump.currentTime = 0; seJump.play();
        }

        window.addEventListener("keydown", e => {
            if (e.key === "ArrowUp") move(0, -1);
            if (e.key === "ArrowDown") move(0, 1);
            if (e.key === "ArrowLeft") move(-1, 0);
            if (e.key === "ArrowRight") move(1, 0);
        });

        canvas.addEventListener("touchstart", e => {
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            const t = e.touches[0];
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            const tx = (t.clientX - rect.left) * scaleX;
            const ty = (t.clientY - rect.top) * scaleY;
            const px = player.x * gridSize + 25; const py = player.y * gridSize + 25;
            if (Math.abs(tx - px) > Math.abs(ty - py)) move(tx > px ? 1 : -1, 0);
            else move(0, ty > py ? 1 : -1);
        }, {passive: false});
    </script>
</body>
</html>
